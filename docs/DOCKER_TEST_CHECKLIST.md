# Docker 测试清单 - 笔记列表树形结构优化

## 测试环境信息

- **Docker Compose**: docker-compose.yml
- **前端地址**: http://localhost:3210
- **后端地址**: http://localhost:4000
- **数据库**: PostgreSQL 15 (端口 5434)

---

## 🚀 启动测试

### 方式一：使用测试脚本（推荐）

```bash
# 添加执行权限
chmod +x test-docker.sh

# 运行测试脚本
./test-docker.sh
```

### 方式二：手动命令

```bash
# 1. 清理旧容器
docker-compose down -v

# 2. 构建镜像
docker-compose build --no-cache

# 3. 启动服务
docker-compose up -d

# 4. 查看日志
docker-compose logs -f

# 5. 运行数据库迁移
docker-compose exec backend npx prisma migrate deploy

# 6. 生成 Prisma Client
docker-compose exec backend npx prisma generate
```

---

## ✅ 功能测试清单

### 前置准备
- [ ] 访问 http://localhost:3210
- [ ] 注册新用户账户
- [ ] 登录成功

### 测试 1: 树形结构显示
**目标**: 验证文件夹以树形结构展示

**步骤**:
1. [ ] 在根目录创建文件夹 "Projects"
2. [ ] 在根目录创建文件夹 "Personal"
3. [ ] 确认两个文件夹在左侧列表中显示
4. [ ] 确认文件夹图标为黄色文件夹 🟡

**预期结果**:
- 文件夹按字母顺序排列
- 显示文件夹图标
- 有清晰的视觉层级

### 测试 2: 文件夹嵌套（创建子文件夹）
**目标**: 验证可以在文件夹下创建子文件夹

**步骤**:
1. [ ] 悬停在 "Projects" 文件夹上
2. [ ] 点击"创建子文件夹"按钮（create_new_folder 图标）
3. [ ] 输入子文件夹名称 "Work"
4. [ ] 点击确认
5. [ ] 在 "Projects" 下再创建子文件夹 "Study"

**预期结果**:
- 子文件夹显示在父文件夹下方
- 子文件夹有缩进显示（向右偏移）
- 可以创建多级嵌套

### 测试 3: 展开/收起按钮
**目标**: 验证文件夹展开和收起功能

**步骤**:
1. [ ] 查看 "Projects" 文件夹左侧的按钮
2. [ ] 点击展开按钮（chevron_right 图标）
3. [ ] 确认子文件夹显示出来
4. [ ] 确认图标变为 expand_more
5. [ ] 再次点击收起
6. [ ] 确认子文件夹隐藏
7. [ ] 确认图标变回 chevron_right

**预期结果**:
- 仅在有子文件夹时显示展开按钮
- 图标正确切换
- 展开/收起动画流畅
- 状态正确保存

### 测试 4: 拖拽移动笔记到文件夹
**目标**: 验证可以通过拖拽将笔记移动到文件夹

**步骤**:
1. [ ] 在根目录创建一个 Markdown 笔记 "Test Note 1"
2. [ ] 创建另一个笔记 "Test Note 2"
3. [ ] 鼠标按住 "Test Note 1" 不放
4. [ ] 拖动到 "Projects" 文件夹上方
5. [ ] 确认文件夹显示拖拽高亮边框
6. [ ] 释放鼠标
7. [ ] 展开 "Projects" 文件夹
8. [ ] 确认 "Test Note 1" 已移动到文件夹内

**预期结果**:
- 拖动时笔记可拖拽
- 悬停在文件夹上时显示虚线边框高亮
- 释放后笔记移动成功
- 笔记从原位置消失

### 测试 5: 拖拽到子文件夹
**目标**: 验证可以拖拽到嵌套的子文件夹

**步骤**:
1. [ ] 展开 "Projects" 文件夹
2. [ ] 拖拽 "Test Note 2" 到子文件夹 "Work"
3. [ ] 确认拖拽高亮显示
4. [ ] 释放鼠标
5. [ ] 进入 "Work" 文件夹查看
6. [ ] 确认笔记已移动

**预期结果**:
- 可以拖拽到任意层级的文件夹
- 视觉反馈正确

### 测试 6: 使用文件夹选择器移动笔记
**目标**: 验证通过菜单选择文件夹移动笔记

**步骤**:
1. [ ] 创建一个新笔记 "Test Note 3"
2. [ ] 点击笔记右侧的"更多"按钮（三个点）
3. [ ] 点击"Move"/"移动"选项
4. [ ] 确认弹出文件夹选择器 modal
5. [ ] 确认显示完整的文件夹树
6. [ ] 确认包含"根目录"选项
7. [ ] 确认显示所有嵌套文件夹
8. [ ] 点击 "Personal" 文件夹
9. [ ] 确认 modal 关闭
10. [ ] 确认笔记移动到 "Personal" 文件夹

**预期结果**:
- Modal 显示完整文件夹树
- 树形结构有正确的缩进
- 点击任意文件夹即可选择
- 移动成功后 modal 自动关闭

### 测试 7: 标签显示（根目录）
**目标**: 验证笔记标签在根目录正确显示

**步骤**:
1. [ ] 返回根目录
2. [ ] 创建新笔记 "Tagged Note"
3. [ ] 点击笔记菜单 -> "Add Tag"
4. [ ] 添加标签 "Important"
5. [ ] 再添加标签 "Urgent"
6. [ ] 再添加标签 "Review"
7. [ ] 查看笔记列表中的标签显示

**预期结果**:
- 显示前 2 个标签
- 标签有背景色
- 超过 2 个显示 "+1" 提示
- 标签位置在笔记标题右侧

### 测试 8: 标签显示（文件夹内）
**目标**: 验证笔记标签在文件夹内正确显示

**步骤**:
1. [ ] 进入 "Personal" 文件夹
2. [ ] 查看之前添加标签的笔记
3. [ ] 确认标签同样显示

**预期结果**:
- 文件夹内的标签显示与根目录一致
- 样式和行为相同

### 测试 9: 视图切换（List/Grid）
**目标**: 验证在不同视图下所有功能正常

**步骤**:
1. [ ] 返回根目录
2. [ ] 切换到 Grid 视图
3. [ ] 确认文件夹树形结构显示正常
4. [ ] 确认展开/收起按钮工作
5. [ ] 尝试拖拽笔记
6. [ ] 切换回 List 视图
7. [ ] 确认所有功能正常

**预期结果**:
- Grid 视图显示正常
- 所有功能在两种视图下都工作
- 切换视图不丢失状态

### 测试 10: 文件夹操作
**目标**: 验证文件夹的重命名和删除

**步骤**:
1. [ ] 悬停在文件夹上
2. [ ] 点击重命名按钮（edit 图标）
3. [ ] 输入新名称
4. [ ] 确认重命名成功
5. [ ] 点击删除按钮（delete 图标）
6. [ ] 确认删除警告 modal
7. [ ] 取消删除
8. [ ] 再次点击删除并确认
9. [ ] 确认文件夹被删除

**预期结果**:
- 重命名立即生效
- 删除前有确认提示
- 删除后文件夹和内容都移除

---

## 🔍 边界情况测试

### 边界 1: 空文件夹
- [ ] 创建空文件夹（无笔记）
- [ ] 确认显示正常
- [ ] 确认可以正常操作

### 边界 2: 深层嵌套
- [ ] 创建 5 层嵌套文件夹
- [ ] 确认所有层级显示正确
- [ ] 确认缩进明显
- [ ] 确认拖拽到最深层文件夹有效

### 边界 3: 大量笔记
- [ ] 在文件夹中创建 20+ 笔记
- [ ] 确认性能流畅
- [ ] 确认滚动正常

### 边界 4: 无标签笔记
- [ ] 创建无标签笔记
- [ ] 确认不显示标签区域
- [ ] 确认布局正常

### 边界 5: 特殊字符
- [ ] 使用特殊字符命名文件夹（如 `项目/2024`）
- [ ] 确认显示和功能正常

---

## 🌐 浏览器兼容性测试

- [ ] Chrome (推荐)
- [ ] Firefox
- [ ] Safari
- [ ] Edge

---

## 📱 响应式测试

### 桌面（1920x1080）
- [ ] 布局正常
- [ ] 所有功能可用

### 笔记本（1366x768）
- [ ] 布局适应
- [ ] 功能正常

### 平板（768x1024）
- [ ] 侧边栏适应
- [ ] 拖拽功能正常

---

## 🐛 常见问题排查

### 问题 1: 服务无法启动
```bash
# 查看详细日志
docker-compose logs backend
docker-compose logs frontend
docker-compose logs postgres

# 检查端口占用
lsof -i :3210
lsof -i :4000
lsof -i :5434
```

### 问题 2: 数据库连接失败
```bash
# 进入数据库容器
docker-compose exec postgres psql -U aiignite -d ai_ignite_note

# 检查数据库状态
\dt

# 查看迁移状态
docker-compose exec backend npx prisma migrate status
```

### 问题 3: 前端无法连接后端
```bash
# 检查后端健康状态
curl http://localhost:4000/health

# 检查网络
docker network inspect aiignitenote_aiignitenet

# 检查 CORS 配置
docker-compose exec backend env | grep CORS_ORIGIN
```

### 问题 4: 拖拽不工作
- 检查浏览器控制台错误
- 确认使用 Chrome 或 Firefox
- 清除浏览器缓存

### 问题 5: 文件夹树不显示
- 刷新页面
- 检查浏览器控制台
- 查看后端日志中的文件夹 API 调用

---

## 📊 测试报告模板

```
测试日期: __________
测试人员: __________
浏览器: __________

功能测试结果:
- 树形结构显示: ✅ / ❌
- 文件夹嵌套: ✅ / ❌
- 展开/收起: ✅ / ❌
- 拖拽移动: ✅ / ❌
- 文件夹选择器: ✅ / ❌
- 标签显示: ✅ / ❌

发现的问题:
1. ___________________________
2. ___________________________

性能表现:
- 响应速度: 快 / 中 / 慢
- 动画流畅度: 流畅 / 卡顿
- 内存占用: 正常 / 偏高

总体评价: ___________________________
```

---

## 🎯 测试通过标准

所有功能测试项必须通过（✅）
- 至少 2 个浏览器测试通过
- 无严重 UI bug
- 性能可接受（无明显卡顿）
- 无数据丢失

---

## 📞 获取支持

如果测试中遇到问题:
1. 查看本文档的"常见问题排查"部分
2. 查看 `docs/CODE_QUALITY_REPORT.md`
3. 查看 `docs/TREE_STRUCTURE_DESIGN.md`
4. 提交 GitHub Issue
